{
  "tasks": [
    {
      "id": "enhance_001",
      "title": "Fix Critical Backend Bugs and API Response Format",
      "description": "CRITICAL multi-file backend fix covering broken logic, missing data, and response format issues.\n\n1. FIX BROKEN contains() in backend/internal/services/challenge_service.go lines 159-161: Current code `func contains(s, substr string) bool { return len(s) \u003e= len(substr) \u0026\u0026 (s == substr || len(s) \u003e len(substr)) }` never actually checks substring presence. Add `\"strings\"` to imports and replace with: `func contains(s, substr string) bool { return strings.Contains(strings.ToLower(s), strings.ToLower(substr)) }`. Also remove the deprecated `rand.Seed(time.Now().UnixNano())` on line 54 (Go 1.20+ auto-seeds).\n\n2. FIX MusicTaste/StyleTraits never populated in backend/internal/services/era_seed.go: Add MusicTaste and StyleTraits fields to EraProfile struct. Set values for each era: 2016_tumblr MusicTaste='Indie rock, The 1975, Arctic Monkeys, Lana Del Rey' StyleTraits='Doc Martens, flannel shirts, band tees, chokers, dark lipstick'; 2018_vsco MusicTaste='Billie Eilish, Lizzo, pop anthems, ukulele covers' StyleTraits='Oversized tees, scrunchies, shell necklaces, Birkenstocks, puka shells'; 2020_cottagecore MusicTaste='Taylor Swift folklore, Phoebe Bridgers, Fleet Foxes, Bon Iver' StyleTraits='Flowy dresses, prairie skirts, straw hats, linen, dried flowers'; 2022_clean_girl MusicTaste='Dua Lipa, SZA, Steve Lacy, Daniel Caesar' StyleTraits='Slick buns, gold hoops, neutral tones, minimal makeup, claw clips'; 2024_mob_wife MusicTaste='Lana Del Rey, Frank Sinatra, Amy Winehouse, classic jazz' StyleTraits='Fur coats, bold red lips, oversized sunglasses, gold chains, leather'; 2025_demure MusicTaste='Sabrina Carpenter, Gracie Abrams, soft pop, acoustic covers' StyleTraits='Modest cuts, ribbon bows, ballet flats, pastel tones, pearl accessories'.\n\n3. In backend/internal/services/era_service.go SubmitQuizAnswers(), after line 110 (EraEmoji), add: `MusicTaste: profile.MusicTaste, StyleTraits: profile.StyleTraits,`\n\n4. FIX GetEraStats in era_service.go: Add total_shares calculation: `var totalShares int64; s.db.Model(\u0026models.EraResult{}).Where(\"user_id = ?\", userID).Select(\"COALESCE(SUM(share_count),0)\").Scan(\u0026totalShares); stats[\"total_shares\"] = totalShares`. Add streak data by accepting streakService or querying EraStreak directly: `var streak models.EraStreak; s.db.Where(\"user_id = ?\", userID).First(\u0026streak); stats[\"current_streak\"] = streak.CurrentStreak; stats[\"longest_streak\"] = streak.LongestStreak`.\n\n5. FIX API response wrapping in backend/internal/handlers/ ‚Äî all handlers wrap responses in `fiber.Map{\"error\": false, ...}` but the mobile app expects the data at different paths. This is fine ‚Äî keep the backend wrapping consistent. The mobile side will be fixed in enhance_003.",
      "status": "in_progress",
      "priority": 10,
      "depends_on": [],
      "test_command": "cd backend \u0026\u0026 go build ./...",
      "auto_commit": true,
      "created_at": "",
      "updated_at": "2026-02-07T14:34:19Z"
    },
    {
      "id": "enhance_002",
      "title": "Expand Era Profiles from 6 to 10 with Rich Metadata",
      "description": "The home screen claims '10 Unique Eras' but only 6 exist. Expand to 10 eras in backend/internal/services/era_seed.go.\n\nADD 4 new EraProfile entries to the EraProfiles map:\n- 'y2k': {Key:'y2k', Title:'Y2K Baby', Description:'Low-rise jeans, butterfly clips, bedazzled everything, Paris Hilton energy', Color:'#FF69B4', Emoji:'üíñ', MusicTaste:'Britney Spears, Christina Aguilera, Destinys Child, NSYNC, early 2000s pop', StyleTraits:'Juicy Couture tracksuits, rhinestones, tiny bags, platform sandals, frosted lips'}\n- 'dark_academia': {Key:'dark_academia', Title:'Dark Academia', Description:'Old libraries, poetry, vintage blazers, intellectual aesthetic', Color:'#3D2B1F', Emoji:'üìö', MusicTaste:'Classical, Hozier, Mitski, Cigarettes After Sex, Tchaikovsky', StyleTraits:'Tweed blazers, turtlenecks, plaid skirts, oxford shoes, leather satchels'}\n- 'indie_sleaze': {Key:'indie_sleaze', Title:'Indie Sleaze', Description:'Messy hair, smudged eyeliner, warehouse parties, effortlessly cool', Color:'#4A0E4E', Emoji:'üé∏', MusicTaste:'The Strokes, Yeah Yeah Yeahs, LCD Soundsystem, Interpol, MGMT', StyleTraits:'Skinny jeans, leather jackets, American Apparel, wayfarers, messy hair'}\n- 'coastal_cowgirl': {Key:'coastal_cowgirl', Title:'Coastal Cowgirl', Description:'Boots meet the beach, turquoise jewelry, sunset chaser vibes', Color:'#87CEEB', Emoji:'ü§†', MusicTaste:'Kacey Musgraves, Shania Twain, Maren Morris, Orville Peck', StyleTraits:'Cowboy boots, denim cutoffs, turquoise jewelry, fringe details, woven bags'}\n\nUpdate EraKeys to all 10: [\"y2k\", \"2016_tumblr\", \"2018_vsco\", \"2020_cottagecore\", \"dark_academia\", \"indie_sleaze\", \"2022_clean_girl\", \"2024_mob_wife\", \"coastal_cowgirl\", \"2025_demure\"]\n\nUpdate seed questions: Change Options from [6]string to [10]string, add 4 new option texts per question mapping to new eras. Example Q1 music: add 'Y2K Pop Hits', 'Classical \u0026 Hozier', 'The Strokes \u0026 Garage Rock', 'Country \u0026 Western'. Update the seed loop to handle 10 options using EraKeys[i].\n\nUpdate challenge_service.go detectEraFromResponse keywords map: Add entries for 'y2k': ['y2k','2000s','butterfly','paris','bedazzled','glitter'], 'dark_academia': ['academia','library','poetry','classical','vintage','tweed'], 'indie_sleaze': ['indie','sleaze','party','messy','leather','punk'], 'coastal_cowgirl': ['cowgirl','boots','beach','turquoise','western','sunset'].",
      "status": "pending",
      "priority": 10,
      "depends_on": [
        "enhance_001"
      ],
      "test_command": "cd backend \u0026\u0026 go build ./...",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_003",
      "title": "Fix All Mobile-Backend API Contract Mismatches",
      "description": "CRITICAL: Mobile calls wrong endpoints and doesn't unwrap backend response envelopes.\n\nBackend wraps all responses in {error: bool, ...data}. Mobile must extract the nested data.\n\n1. mobile/app/(protected)/(tabs)/challenge.tsx:\n- Line 44: Change `api.get('/era/challenge')` ‚Üí `api.get('/challenges/daily')`. Extract: `challengeRes.data.challenge`\n- Line 45: Change `api.get('/era/streak')` ‚Üí `api.get('/challenges/streak')`. Extract: `streakRes.data.streak`\n- Line 72: Change `api.post('/era/challenge/${challenge.id}', ...)` ‚Üí `api.post('/challenges/submit', { response: response.trim() })`\n- Update DailyChallenge interface: replace `challenge_text` with `prompt`, replace `has_responded` with checking `response !== ''`\n- Update JSX: `challenge.challenge_text` ‚Üí `challenge.prompt`, `challenge.has_responded` ‚Üí `(challenge.response \u0026\u0026 challenge.response !== '')`\n\n2. mobile/app/(protected)/(tabs)/index.tsx:\n- Line 42: `api.get('/era/streak')` ‚Üí `api.get('/challenges/streak')`, extract `streakRes.data.streak`\n- Line 43: `api.get('/era/results')` remains correct but extract `resultsRes.data.results`\n\n3. mobile/app/(protected)/(tabs)/settings.tsx:\n- Line 40: `api.get('/era/stats')` remains but extract `data.stats`. The favorite_era_profile is nested: access emoji via `stats.favorite_era_profile?.emoji`, title via `stats.favorite_era_profile?.title`\n- Update EraStats interface to include `favorite_era_profile?: { key: string; title: string; emoji: string; color: string; description: string; music_taste: string; style_traits: string; }`\n\n4. mobile/app/(protected)/quiz.tsx:\n- Line 44: Extract `data.questions` instead of `data` directly\n- Line 81: Extract result ID from `data.data.result.id` (backend returns {error, data: {result, profile}})\n\n5. mobile/app/(protected)/results/[id].tsx:\n- Line 50: Extract `data.data.result` (backend returns {error, data: {result, profile}})\n- Fix EraResult interface: `scores` from backend is a JSON object `{era_key: percentage}` not an array. Convert: `const scoresArray = Object.entries(resultData.scores || {}).map(([era, score]) =\u003e ({ era, score: score as number }))`\n\n6. mobile/app/(protected)/(tabs)/history.tsx:\n- Extract `data.results` from the response instead of `data` directly",
      "status": "pending",
      "priority": 9,
      "depends_on": [
        "enhance_001"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_004",
      "title": "Fix App Identity and Remove Dead Template Code",
      "description": "Remove template placeholders that will cause App Store rejection (Guideline 2.1) and fix app identity.\n\n1. DELETE mobile/app/(protected)/home.tsx ‚Äî contains 'App Factory', 'Phase 0 Master Template', 'Your MVP starts here'. This is dead template code not referenced in tabs navigation.\n\n2. DELETE mobile/app/(protected)/settings.tsx (the non-tabs one) ‚Äî duplicate settings screen with placeholder restore purchases ('In production, call RevenueCat restorePurchases method' comment). The active settings is in (tabs)/settings.tsx.\n\n3. Update mobile/app/index.tsx: Change `\u003cRedirect href=\"/(protected)/home\" /\u003e` to `\u003cRedirect href=\"/(protected)/(tabs)\" /\u003e` since home.tsx is deleted.\n\n4. Update mobile/app/(protected)/_layout.tsx: Remove any Stack.Screen entries for 'home' and the non-tabs 'settings'. Keep only: (tabs), quiz, results/[id], paywall.\n\n5. Update mobile/app.json:\n- Change `\"name\": \"mobile\"` ‚Üí `\"name\": \"EraCheck\"`\n- Change `\"slug\": \"mobile\"` ‚Üí `\"slug\": \"eracheck\"`\n- Change `\"scheme\": \"appfactory\"` ‚Üí `\"scheme\": \"eracheck\"`\n- Change splash backgroundColor from `\"#ffffff\"` to `\"#2563eb\"` (brand blue)\n- Add `\"bundleIdentifier\": \"com.eracheck.app\"` inside ios object\n\n6. Fix mobile/app/(protected)/(tabs)/settings.tsx:\n- Import `useSubscription` from '../../../contexts/SubscriptionContext'\n- Replace placeholder handleRestorePurchases: `const { handleRestore } = useSubscription(); const handleRestorePurchases = async () =\u003e { hapticLight(); try { const restored = await handleRestore(); if (restored) { hapticSuccess(); Alert.alert('Success', 'Your purchases have been restored!'); } else { Alert.alert('Not Found', 'No previous purchases found.'); } } catch { hapticError(); Alert.alert('Error', 'Failed to restore purchases.'); } };`\n\n7. DELETE backend/cmd/main.go ‚Äî deprecated entry point replaced by cmd/server/main.go. It has inline CORS, inline DB, no graceful shutdown.",
      "status": "pending",
      "priority": 8,
      "depends_on": [],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_005",
      "title": "Add 3-Screen Onboarding Flow with Smart Routing",
      "description": "Create a 3-screen onboarding and update the app entry point for smart routing.\n\nCreate mobile/app/onboarding.tsx:\n- Use a horizontal ScrollView with pagingEnabled, showsHorizontalScrollIndicator={false}, and 3 full-width pages.\n- State: `const [currentPage, setCurrentPage] = useState(0);` Track via onScroll event.\n\nPage 1 (Welcome): SafeAreaView flex-1 items-center justify-center px-8. Ionicons 'sparkles' size={80} color='#2563eb'. Text 'EraCheck' className='text-4xl font-bold mt-6' style={{color:'#2563eb'}}. Text 'Discover Your Aesthetic Era' className='text-xl text-gray-600 mt-3 text-center'.\n\nPage 2 (Features): 3 feature cards vertically stacked with px-8 pt-12. Each card: View className='flex-row items-center bg-blue-50 rounded-2xl p-5 mb-4'. Icon (sparkles/calendar/share-social, size 32, color #2563eb) + View ml-4 with Text font-bold text-gray-900 + Text text-sm text-gray-600. Cards: '10 Unique Eras'/'From Y2K to Demure Queen', 'Daily Challenges'/'Keep your streak alive', 'Share Your Vibe'/'Compare eras with friends'.\n\nPage 3 (CTA): View items-center justify-center px-8. Text 'Ready to find your era?' className='text-3xl font-bold text-gray-900 text-center'. Two buttons: 'Try Free' (style={{backgroundColor:'#2563eb'}} rounded-2xl py-4 w-full items-center mt-8, onPress: setItemAsync('guest_mode','true') then router.replace('/(protected)/(tabs)')). 'Sign In' (border-2 style={{borderColor:'#2563eb'}} rounded-2xl py-4 w-full items-center mt-3, onPress: router.replace('/(auth)/login')).\n\nPage dots: 3 Views w-2.5 h-2.5 rounded-full mx-1, active=bg-blue-600 inactive=bg-gray-300.\n\nOn completion: `await SecureStore.setItemAsync('onboarding_complete', 'true');`\n\nUpdate mobile/app/index.tsx:\n- Import SecureStore. Check: `const onboarded = await SecureStore.getItemAsync('onboarding_complete');` If !onboarded ‚Üí \u003cRedirect href='/onboarding' /\u003e. Then check `const guest = await SecureStore.getItemAsync('guest_mode');` If guest ‚Üí \u003cRedirect href='/(protected)/(tabs)' /\u003e. Then existing auth check.\n\nUpdate mobile/app/(protected)/_layout.tsx:\n- Also allow access if SecureStore has 'guest_mode' = 'true' (not just isAuthenticated).",
      "status": "pending",
      "priority": 8,
      "depends_on": [
        "enhance_004"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_006",
      "title": "Build Custom Slot-Based Tab Bar for NativeWind v4",
      "description": "Replace expo-router Tabs component with a custom Slot-based tab bar for full NativeWind v4 compatibility. The Tabs component uses native tab bar which doesn't support NativeWind className styling.\n\nRewrite mobile/app/(protected)/(tabs)/_layout.tsx entirely:\n\nImports: `import React from 'react'; import { View, Text, Pressable } from 'react-native'; import { Slot, usePathname, useRouter } from 'expo-router'; import { Ionicons } from '@expo/vector-icons'; import { useSafeAreaInsets } from 'react-native-safe-area-context'; import { hapticSelection } from '../../../lib/haptics';`\n\nDefine tab config: `const tabs = [ { path: '/(protected)/(tabs)', icon: 'sparkles' as const, iconOutline: 'sparkles-outline' as const, label: 'Quiz' }, { path: '/(protected)/(tabs)/history', icon: 'time' as const, iconOutline: 'time-outline' as const, label: 'History' }, { path: '/(protected)/(tabs)/challenge', icon: 'calendar' as const, iconOutline: 'calendar-outline' as const, label: 'Daily' }, { path: '/(protected)/(tabs)/settings', icon: 'settings' as const, iconOutline: 'settings-outline' as const, label: 'Settings' } ];`\n\nComponent body:\n```tsx\nexport default function TabsLayout() {\n  const pathname = usePathname();\n  const router = useRouter();\n  const insets = useSafeAreaInsets();\n  return (\n    \u003cView className='flex-1 bg-white'\u003e\n      \u003cView className='flex-1'\u003e\u003cSlot /\u003e\u003c/View\u003e\n      \u003cView className='flex-row border-t border-gray-100 bg-white' style={{ paddingBottom: insets.bottom || 8 }}\u003e\n        {tabs.map((tab) =\u003e {\n          const isActive = pathname === tab.path || (tab.path.endsWith('(tabs)') \u0026\u0026 (pathname === '/' || pathname === ''));\n          return (\n            \u003cPressable key={tab.path} onPress={() =\u003e { hapticSelection(); router.push(tab.path as any); }} className='flex-1 items-center pt-2 pb-1'\u003e\n              \u003cIonicons name={isActive ? tab.icon : tab.iconOutline} size={24} color={isActive ? '#2563eb' : '#9ca3af'} /\u003e\n              \u003cText style={{ color: isActive ? '#2563eb' : '#9ca3af', fontSize: 10, fontWeight: isActive ? '600' : '400', marginTop: 2 }}\u003e{tab.label}\u003c/Text\u003e\n            \u003c/Pressable\u003e\n          );\n        })}\n      \u003c/View\u003e\n    \u003c/View\u003e\n  );\n}\n```\n\nThis removes the `Tabs` import from expo-router entirely. The Slot renders the active child route. The custom bottom bar provides full styling control with haptic feedback.",
      "status": "pending",
      "priority": 7,
      "depends_on": [
        "enhance_004"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_007",
      "title": "Fix NativeWind Gradient Classes and Polish Home Screen",
      "description": "NativeWind v4 does NOT support CSS gradient classes like bg-gradient-to-r in React Native. Fix all gradient usages and polish the home screen.\n\n1. mobile/app/(protected)/(tabs)/index.tsx ‚Äî Streak Badge (line 96): Replace `className=\"bg-gradient-to-r from-orange-500 to-pink-500 rounded-2xl p-4 mb-6 flex-row items-center\"` with `className=\"rounded-2xl p-5 mb-6 flex-row items-center shadow-lg\" style={{ backgroundColor: '#f97316' }}`. The gradient won't render ‚Äî solid orange is the working alternative.\n\n2. mobile/app/(protected)/(tabs)/challenge.tsx ‚Äî Streak Card (line 121): Same fix. Replace gradient class with `style={{ backgroundColor: '#f97316' }}` and keep className for layout/radius.\n\n3. mobile/app/(protected)/(tabs)/settings.tsx ‚Äî Stats Card (line 126): Replace `className=\"bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-6 mb-6\"` with `className=\"rounded-2xl p-6 mb-6 shadow-lg\" style={{ backgroundColor: '#9333ea' }}`.\n\n4. POLISH HOME SCREEN (index.tsx): Add RefreshControl to ScrollView: `import { RefreshControl } from 'react-native'`. Add state: `const [refreshing, setRefreshing] = useState(false)`. Add handler: `const onRefresh = async () =\u003e { setRefreshing(true); await loadData(); setRefreshing(false); }`. Add to ScrollView: `refreshControl={\u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} tintColor='#2563eb' /\u003e}`.\n\n5. FIX space-y-4 (line 149): Replace `className=\"mt-8 space-y-4\"` with `className=\"mt-8\"` and add `className=\"mb-4\"` to each child info card View.\n\n6. ADD ICONS to info cards: Import Ionicons (already imported). Add icons to each card in a flex-row: 'sparkles' for '10 Unique Eras', 'musical-notes' for 'Personalized Results', 'share-social' for 'Share \u0026 Compare'. Each card becomes: `\u003cView className='rounded-xl p-4 mb-4 flex-row items-center' style={{backgroundColor:'#faf5ff'}}\u003e\u003cIonicons name='sparkles' size={24} color='#9333ea' /\u003e\u003cView className='ml-3 flex-1'\u003e\u003cText ...\u003eTitle\u003c/Text\u003e\u003cText ...\u003eDescription\u003c/Text\u003e\u003c/View\u003e\u003c/View\u003e`\n\n7. ENHANCE START QUIZ BUTTON: Add shadow-lg to the existing TouchableOpacity. Add subtitle text: `\u003cText className='text-white/70 text-xs mt-1'\u003e15 questions ‚Ä¢ 2 min\u003c/Text\u003e` below 'Discover your aesthetic era'.",
      "status": "pending",
      "priority": 7,
      "depends_on": [
        "enhance_003"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_008",
      "title": "Enhance Results Screen with Era Details and Share Prompt",
      "description": "Polish mobile/app/(protected)/results/[id].tsx for a premium shareable experience.\n\n1. FIX SCORES PARSING: Backend returns scores as JSON object `{era_key: percentage_float}` not an array. Update the EraResult interface: change `scores: EraScore[]` to `scores: Record\u003cstring, number\u003e`. In the component, convert to array for rendering: `const scoresArray = Object.entries(result.scores || {}).map(([era, score]) =\u003e ({ era, score: score as number })).sort((a, b) =\u003e b.score - a.score);`\n\n2. ADD ERA EMOJI MAPPING: Create a constant at top of file: `const eraDisplayNames: Record\u003cstring, {name: string, emoji: string}\u003e = { 'y2k': {name: 'Y2K Baby', emoji: 'üíñ'}, '2016_tumblr': {name: 'Tumblr Girl', emoji: 'üåô'}, '2018_vsco': {name: 'VSCO Girl', emoji: '‚úåÔ∏è'}, '2020_cottagecore': {name: 'Cottagecore', emoji: 'üåø'}, 'dark_academia': {name: 'Dark Academia', emoji: 'üìö'}, 'indie_sleaze': {name: 'Indie Sleaze', emoji: 'üé∏'}, '2022_clean_girl': {name: 'Clean Girl', emoji: '‚ú®'}, '2024_mob_wife': {name: 'Mob Wife', emoji: 'üíã'}, 'coastal_cowgirl': {name: 'Coastal Cowgirl', emoji: 'ü§†'}, '2025_demure': {name: 'Demure Queen', emoji: 'ü§´'} };` Use in score breakdown to show emoji + readable name instead of raw era keys.\n\n3. CONDITIONAL SECTIONS: Only show Music Taste section if `result.music_taste` is not empty. Only show Style Traits if `result.style_traits` is not empty. Wrap each in: `{result.music_taste ? (\u003cView\u003e...\u003c/View\u003e) : null}`\n\n4. MUSIC \u0026 STYLE CARDS: Give each a themed background. Music: `className='rounded-2xl p-5 mb-4' style={{backgroundColor:'#eff6ff'}}` (blue-50). Style: `className='rounded-2xl p-5 mb-4' style={{backgroundColor:'#faf5ff'}}` (purple-50).\n\n5. SHARE PROMPT: After the main era card, add a subtle prompt: View className='mx-6 mt-4 flex-row items-center justify-center' with Ionicons 'heart' size={16} color='#ef4444' and Text 'Share your era with friends!' text-gray-500 text-sm ml-2.\n\n6. ADD hapticSuccess() in the useEffect after result loads successfully (celebration feedback).\n\n7. ADD 'View History' button below 'Retake Quiz': `\u003cTouchableOpacity onPress={() =\u003e router.push('/(protected)/(tabs)/history')} className='rounded-xl py-4 items-center mb-4'\u003e\u003cText className='text-blue-600 font-semibold text-lg'\u003eView All Results\u003c/Text\u003e\u003c/TouchableOpacity\u003e`",
      "status": "pending",
      "priority": 7,
      "depends_on": [
        "enhance_003"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_009",
      "title": "Enhance Challenge Screen with Badges and History",
      "description": "Polish mobile/app/(protected)/(tabs)/challenge.tsx with streak badge display and challenge history.\n\n1. ADD BADGES STATE: Add `const [badges, setBadges] = useState\u003cArray\u003c{name: string; emoji: string; required: number; unlocked: boolean}\u003e\u003e([]);` In loadData, the `/challenges/streak` response includes both streak and badges. Extract both: `setBadges(streakRes.data.badges || []);`\n\n2. ADD BADGE DISPLAY: After the streak card, add a horizontal ScrollView: `\u003cScrollView horizontal showsHorizontalScrollIndicator={false} className='mb-6'\u003e{badges.map((badge, i) =\u003e (\u003cView key={i} className='items-center mr-4' style={{opacity: badge.unlocked ? 1 : 0.35}}\u003e\u003cView className='w-14 h-14 rounded-full items-center justify-center' style={{backgroundColor: badge.unlocked ? '#dbeafe' : '#f3f4f6'}}\u003e\u003cText style={{fontSize: 24}}\u003e{badge.emoji}\u003c/Text\u003e\u003c/View\u003e\u003cText className='text-xs text-gray-700 mt-1 font-medium'\u003e{badge.name}\u003c/Text\u003e\u003cText className='text-xs text-gray-400'\u003e{badge.required}d\u003c/Text\u003e\u003c/View\u003e))}\u003c/ScrollView\u003e`\n\n3. FIX GRADIENT (line 121): Already addressed in enhance_007. Ensure style={{backgroundColor:'#f97316'}} is used.\n\n4. ADD CHARACTER COUNT: Below TextInput, add: `\u003cText className='text-right text-xs text-gray-400 mt-1'\u003e{response.length}/500\u003c/Text\u003e`. Add `maxLength={500}` prop to TextInput.\n\n5. ADD CHALLENGE HISTORY: Add state `const [history, setHistory] = useState\u003cany[]\u003e([]);`. In loadData, also fetch: `const historyRes = await api.get('/challenges/history?limit=5'); setHistory(historyRes.data.challenges || []);`. After the submit section, add: `{history.length \u003e 0 \u0026\u0026 (\u003cView className='mt-6'\u003e\u003cText className='text-lg font-bold text-gray-900 mb-3'\u003ePrevious Challenges\u003c/Text\u003e{history.map((h: any) =\u003e (\u003cView key={h.id} className='rounded-xl p-4 mb-3' style={{backgroundColor:'#f9fafb'}}\u003e\u003cText className='text-sm text-gray-500'\u003e{new Date(h.challenge_date).toLocaleDateString()}\u003c/Text\u003e\u003cText className='text-gray-800 font-medium mt-1' numberOfLines={1}\u003e{h.prompt}\u003c/Text\u003e{h.era \u0026\u0026 \u003cText className='text-xs text-gray-400 mt-1'\u003eEra: {h.era}\u003c/Text\u003e}\u003c/View\u003e))}\u003c/View\u003e)}`\n\n6. ADD EMPTY STATE: If challenge is null after loading, show: Ionicons 'calendar-outline' size={64} color='#d1d5db', text 'No Challenge Today' and 'Check back tomorrow!'.",
      "status": "pending",
      "priority": 6,
      "depends_on": [
        "enhance_003"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_010",
      "title": "Polish Auth Screens with Branding and Guest Mode",
      "description": "Enhance login and register screens with EraCheck branding and add guest mode skip option.\n\nUpdate mobile/app/(auth)/login.tsx:\n1. BRANDED HEADER: Replace generic text with EraCheck branding. Before the form inputs, add: `\u003cView className='items-center mb-8'\u003e\u003cIonicons name='sparkles' size={48} color='#2563eb' /\u003e\u003cText className='text-3xl font-bold mt-4' style={{color:'#2563eb'}}\u003eEraCheck\u003c/Text\u003e\u003cText className='text-lg text-gray-600 mt-2'\u003eWelcome back\u003c/Text\u003e\u003c/View\u003e`\n\n2. ADD GUEST SKIP: Below the 'Don't have an account? Sign Up' link, add with mt-6: `\u003cTouchableOpacity onPress={handleGuestSkip} className='items-center py-2'\u003e\u003cText className='text-gray-400 text-sm'\u003eSkip for now\u003c/Text\u003e\u003c/TouchableOpacity\u003e`. Add handler: `import * as SecureStore from 'expo-secure-store';` then `const handleGuestSkip = async () =\u003e { hapticLight(); await SecureStore.setItemAsync('guest_mode', 'true'); router.replace('/(protected)/(tabs)'); };`\n\n3. FORM STYLING: Ensure inputs have consistent styling with rounded-xl, proper labels, and error states. Add hapticLight() call on the login button press.\n\nUpdate mobile/app/(auth)/register.tsx:\n1. BRANDED HEADER: Same as login but subtitle: 'Create your account'. Description: 'Join thousands discovering their aesthetic era' className='text-sm text-gray-500 mt-1 text-center'.\n\n2. ADD APPLE SIGN IN: Below the Create Account button, add the AppleSignInButton component: `import AppleSignInButton from '../../components/ui/AppleSignInButton';` and render: `\u003cAppleSignInButton onError={(msg: string) =\u003e setError(msg)} /\u003e`\n\n3. ADD TERMS TEXT: At the very bottom: `\u003cText className='text-gray-400 text-xs text-center mt-4 px-4'\u003eBy creating an account, you agree to our Terms of Service and Privacy Policy\u003c/Text\u003e`\n\n4. Ensure register() auto-redirects: After successful registration, AuthContext.register already saves tokens and sets user, which triggers the auth guard redirect. Verify the flow works by ensuring no explicit router.push is needed.",
      "status": "pending",
      "priority": 6,
      "depends_on": [
        "enhance_005"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_011",
      "title": "Polish Settings with Premium Card and Stats Fix",
      "description": "Enhance mobile/app/(protected)/(tabs)/settings.tsx with premium upsell, proper stats, and compliance items.\n\n1. FIX STATS GRADIENT: Already fixed in enhance_007 with style={{backgroundColor:'#9333ea'}}. Ensure it's applied.\n\n2. FIX STATS MAPPING: After enhance_003 fixes response extraction, update the rendering. The `favorite_era` is a string key and `favorite_era_profile` is the full profile object. Update: `{stats.favorite_era_profile \u0026\u0026 (\u003cView className='mt-3 pt-3' style={{borderTopWidth:1,borderTopColor:'rgba(255,255,255,0.2)'}}\u003e\u003cText className='text-white/90 mb-2'\u003eFavorite Era\u003c/Text\u003e\u003cView className='flex-row items-center'\u003e\u003cText className='text-4xl mr-3'\u003e{stats.favorite_era_profile.emoji}\u003c/Text\u003e\u003cText className='text-white font-bold text-lg'\u003e{stats.favorite_era_profile.title}\u003c/Text\u003e\u003c/View\u003e\u003c/View\u003e)}`\n\n3. ADD PREMIUM CARD: Import `useSubscription` from contexts. Above the Account section, if `!isSubscribed`: `\u003cTouchableOpacity onPress={() =\u003e router.push('/(protected)/paywall')} className='rounded-2xl p-5 mb-6 shadow-md' style={{backgroundColor:'#2563eb'}}\u003e\u003cView className='flex-row items-center'\u003e\u003cIonicons name='diamond-outline' size={28} color='#fff' /\u003e\u003cView className='ml-3 flex-1'\u003e\u003cText className='text-white font-bold text-lg'\u003eUpgrade to Premium\u003c/Text\u003e\u003cText className='text-white/80 text-sm'\u003eUnlimited quizzes, exclusive eras, no ads\u003c/Text\u003e\u003c/View\u003e\u003cIonicons name='chevron-forward' size={20} color='#fff' /\u003e\u003c/View\u003e\u003c/TouchableOpacity\u003e`\n\n4. ADD ABOUT SECTION: After Actions section: `\u003cView className='mb-6'\u003e\u003cText className='text-gray-500 text-sm font-semibold uppercase mb-3'\u003eAbout\u003c/Text\u003e\u003cTouchableOpacity onPress={() =\u003e Linking.openURL('https://example.com/terms')} className='bg-white border border-gray-200 rounded-xl p-4 mb-3 flex-row items-center justify-between'\u003e\u003cView className='flex-row items-center'\u003e\u003cIonicons name='document-text-outline' size={24} color='#2563eb' /\u003e\u003cText className='text-gray-900 font-medium ml-3'\u003eTerms of Service\u003c/Text\u003e\u003c/View\u003e\u003cIonicons name='chevron-forward' size={20} color='#9ca3af' /\u003e\u003c/TouchableOpacity\u003e\u003c/View\u003e`\n\n5. FIX space-y-3 in stats card: Replace with explicit mb-3 on each stat row.",
      "status": "pending",
      "priority": 6,
      "depends_on": [
        "enhance_003",
        "enhance_007"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_012",
      "title": "Add Guest Mode Usage Tracking with Paywall Gate",
      "description": "Implement 3-free-quizzes guest limit using expo-secure-store.\n\nCreate mobile/lib/guest.ts:\n```typescript\nimport * as SecureStore from 'expo-secure-store';\n\nconst GUEST_MODE_KEY = 'guest_mode';\nconst GUEST_QUIZ_COUNT_KEY = 'guest_quiz_count';\nconst MAX_FREE_QUIZZES = 3;\n\nexport const isGuestMode = async (): Promise\u003cboolean\u003e =\u003e {\n  const val = await SecureStore.getItemAsync(GUEST_MODE_KEY);\n  return val === 'true';\n};\n\nexport const getGuestQuizCount = async (): Promise\u003cnumber\u003e =\u003e {\n  const val = await SecureStore.getItemAsync(GUEST_QUIZ_COUNT_KEY);\n  return val ? parseInt(val, 10) : 0;\n};\n\nexport const incrementGuestQuizCount = async (): Promise\u003cnumber\u003e =\u003e {\n  const count = await getGuestQuizCount();\n  const newCount = count + 1;\n  await SecureStore.setItemAsync(GUEST_QUIZ_COUNT_KEY, newCount.toString());\n  return newCount;\n};\n\nexport const canTakeQuiz = async (): Promise\u003cboolean\u003e =\u003e {\n  const guest = await isGuestMode();\n  if (!guest) return true;\n  const count = await getGuestQuizCount();\n  return count \u003c MAX_FREE_QUIZZES;\n};\n\nexport const getRemainingQuizzes = async (): Promise\u003cnumber\u003e =\u003e {\n  const count = await getGuestQuizCount();\n  return Math.max(0, MAX_FREE_QUIZZES - count);\n};\n\nexport const clearGuestMode = async (): Promise\u003cvoid\u003e =\u003e {\n  await SecureStore.deleteItemAsync(GUEST_MODE_KEY);\n  await SecureStore.deleteItemAsync(GUEST_QUIZ_COUNT_KEY);\n};\n```\n\nUpdate mobile/app/(protected)/quiz.tsx:\n- Import { canTakeQuiz, incrementGuestQuizCount, isGuestMode } from '../../lib/guest'\n- In loadQuestions, before fetching: `const allowed = await canTakeQuiz(); if (!allowed) { Alert.alert('Free Limit Reached', 'Sign up for unlimited quizzes!', [{ text: 'Sign Up', onPress: () =\u003e router.replace('/(auth)/register') }, { text: 'Get Premium', onPress: () =\u003e router.replace('/(protected)/paywall') }]); router.back(); return; }`\n- After successful submit (line 83, after hapticSuccess): `const guest = await isGuestMode(); if (guest) await incrementGuestQuizCount();`\n\nUpdate mobile/app/(protected)/(tabs)/index.tsx:\n- Import { isGuestMode, getRemainingQuizzes } from '../../../lib/guest'\n- Add state: `const [guestRemaining, setGuestRemaining] = useState\u003cnumber | null\u003e(null);`\n- In loadData: `const guest = await isGuestMode(); if (guest) { const rem = await getRemainingQuizzes(); setGuestRemaining(rem); }`\n- Before Start Quiz button, if guestRemaining !== null: `\u003cView className='rounded-xl p-4 mb-4 flex-row items-center justify-between' style={{backgroundColor:'#fffbeb',borderWidth:1,borderColor:'#fde68a'}}\u003e\u003cView className='flex-row items-center'\u003e\u003cIonicons name='person-outline' size={20} color='#d97706' /\u003e\u003cText className='text-amber-700 font-medium ml-2'\u003eGuest Mode: {guestRemaining} quizzes left\u003c/Text\u003e\u003c/View\u003e\u003cTouchableOpacity onPress={() =\u003e router.push('/(auth)/login')}\u003e\u003cText className='text-amber-600 font-semibold text-sm'\u003eSign Up\u003c/Text\u003e\u003c/TouchableOpacity\u003e\u003c/View\u003e`",
      "status": "pending",
      "priority": 5,
      "depends_on": [
        "enhance_005",
        "enhance_007"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    },
    {
      "id": "enhance_013",
      "title": "Polish History Screen with Empty State and Grouped Results",
      "description": "Enhance mobile/app/(protected)/(tabs)/history.tsx for better browsing UX.\n\n1. ENHANCED EMPTY STATE: Replace the current empty state with a more visual design. Center content with: `\u003cView className='flex-1 items-center justify-center px-8'\u003e\u003cView className='w-32 h-32 rounded-full items-center justify-center' style={{backgroundColor:'#eff6ff'}}\u003e\u003cIonicons name='sparkles-outline' size={64} color='#93c5fd' /\u003e\u003c/View\u003e\u003cText className='text-xl font-bold text-gray-900 mt-6'\u003eNo Eras Discovered Yet\u003c/Text\u003e\u003cText className='text-gray-500 text-center mt-2'\u003eTake the quiz to discover which aesthetic era defines your vibe\u003c/Text\u003e\u003cTouchableOpacity onPress={() =\u003e router.push('/(protected)/quiz')} className='rounded-2xl px-8 py-4 mt-8 shadow-lg' style={{backgroundColor:'#2563eb'}}\u003e\u003cText className='text-white font-bold text-lg'\u003eTake the Quiz\u003c/Text\u003e\u003c/TouchableOpacity\u003e\u003c/View\u003e`\n\n2. STATS HEADER: Above the FlatList, if results exist, show: `\u003cView className='rounded-xl p-3 mb-4 flex-row items-center justify-between' style={{backgroundColor:'#f9fafb'}}\u003e\u003cText className='text-gray-600 text-sm'\u003e{results.length} result{results.length !== 1 ? 's' : ''}\u003c/Text\u003e\u003c/View\u003e`\n\n3. RESULT CARD ENHANCEMENT: Each card currently shows emoji, title, date, share count. Add: shadow-sm to each card wrapper. Add era description as a one-line snippet: `\u003cText className='text-gray-500 text-xs mt-1' numberOfLines={1}\u003e{item.era_description}\u003c/Text\u003e`. Make sure the interface includes era_description.\n\n4. FIX RESPONSE EXTRACTION: After enhance_003, results come from `data.results`. Ensure the loadResults function extracts correctly.\n\n5. ADD PULL-TO-REFRESH: The current FlatList already has RefreshControl. Verify the `onRefresh` handler works correctly with the new response extraction.\n\n6. DATE FORMATTING: Format dates more nicely: `new Date(item.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })` ‚Üí 'Feb 7, 2026'.\n\n7. ADD LIST FOOTER: When results exist, show at bottom: `\u003cView className='items-center py-6'\u003e\u003cText className='text-gray-400 text-sm'\u003eYou've seen all your results\u003c/Text\u003e\u003c/View\u003e`",
      "status": "pending",
      "priority": 5,
      "depends_on": [
        "enhance_003"
      ],
      "test_command": "cd mobile \u0026\u0026 npx tsc --noEmit",
      "auto_commit": true,
      "created_at": "",
      "updated_at": ""
    }
  ]
}